<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ§åˆ¶æ¡æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .time-range-slider {
            margin: 20px 0;
            padding: 20px 0;
            background: #f5f5f5;
            border-radius: 8px;
            padding: 20px;
        }
        .slider-container {
            position: relative;
            margin: 20px 0;
        }
        .slider-track {
            width: 100%;
            height: 8px;
            background: #ddd;
            border-radius: 4px;
            position: relative;
            cursor: pointer;
        }
        .slider-range {
            position: absolute;
            height: 100%;
            background: #667eea;
            border-radius: 4px;
            cursor: move;
        }
        .slider-handle {
            position: absolute;
            width: 20px;
            height: 20px;
            background: #667eea;
            border: 2px solid white;
            border-radius: 50%;
            cursor: grab;
            top: -6px;
            transform: translateX(-50%);
        }
        .slider-handle:hover {
            transform: translateX(-50%) scale(1.2);
        }
        .slider-handle.dragging {
            cursor: grabbing;
            transform: translateX(-50%) scale(1.3);
        }
        .slider-handle.left {
            left: 0;
        }
        .slider-handle.right {
            right: 0;
        }
        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 12px;
            color: #666;
        }
        .test-info {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .test-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #5a67d8;
        }
    </style>
</head>
<body>
    <h1>æ§åˆ¶æ¡å’Œæ§åˆ¶ç‚¹æµ‹è¯•</h1>
    
    <div class="test-info">
        <h3>æµ‹è¯•çŠ¶æ€</h3>
        <p id="testStatus">åˆå§‹åŒ–ä¸­...</p>
        <button class="test-button" onclick="testControlEvents()">æµ‹è¯•æ§åˆ¶äº‹ä»¶</button>
        <button class="test-button" onclick="resetSlider()">é‡ç½®æ»‘å—</button>
    </div>
    
    <div class="time-range-slider" id="timeRangeSlider">
        <h3>æ—¶é—´è½´æ§åˆ¶æ¡</h3>
        <div class="slider-container">
            <div class="slider-track">
                <div class="slider-range" id="sliderRange">
                    <div class="slider-handle left" id="leftHandle"></div>
                    <div class="slider-handle right" id="rightHandle"></div>
                </div>
            </div>
        </div>
        <div class="slider-labels">
            <span id="sliderLabelStart">00:00</span>
            <span id="sliderLabelEnd">24:00</span>
        </div>
        <div style="margin-top: 15px;">
            <strong>å½“å‰èŒƒå›´ï¼š</strong>
            <span id="currentRange">00:00 - 24:00</span>
        </div>
    </div>
    
    <div class="test-info">
        <h3>äº‹ä»¶æ—¥å¿—</h3>
        <div id="eventLog" style="max-height: 200px; overflow-y: auto; background: white; padding: 10px; border: 1px solid #ddd; border-radius: 3px;"></div>
        <button class="test-button" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
    </div>

    <script>
        // æ¨¡æ‹Ÿæ—¶é—´è½´æ•°æ®
        const timeRangeData = {
            startTime: new Date().setHours(0, 0, 0, 0), // ä»Šå¤©00:00
            endTime: new Date().setHours(23, 59, 59, 999), // ä»Šå¤©23:59:59
            viewStart: new Date().setHours(0, 0, 0, 0),
            viewEnd: new Date().setHours(23, 59, 59, 999),
            isDragging: false,
            dragType: null,
            lastMouseX: 0,
            initialized: false
        };
        
        // æ—¥å¿—å‡½æ•°
        function logEvent(message) {
            const log = document.getElementById('eventLog');
            const time = new Date().toLocaleTimeString();
            log.innerHTML += `<div>[${time}] ${message}</div>`;
            log.scrollTop = log.scrollHeight;
            console.log(`[æ§åˆ¶æ¡æµ‹è¯•] ${message}`);
        }
        
        function clearLog() {
            document.getElementById('eventLog').innerHTML = '';
        }
        
        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            const range = document.getElementById('currentRange');
            const startTime = new Date(timeRangeData.viewStart);
            const endTime = new Date(timeRangeData.viewEnd);
            
            const startStr = startTime.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit', hour12: false });
            const endStr = endTime.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit', hour12: false });
            
            range.textContent = `${startStr} - ${endStr}`;
            
            // æ›´æ–°æ»‘å—ä½ç½®
            updateSliderDisplay();
        }
        
        // æ›´æ–°æ»‘å—æ˜¾ç¤º
        function updateSliderDisplay() {
            const sliderRange = document.getElementById('sliderRange');
            const startLabel = document.getElementById('sliderLabelStart');
            const endLabel = document.getElementById('sliderLabelEnd');
            
            if (!sliderRange || !startLabel || !endLabel) return;
            
            const totalRange = timeRangeData.endTime - timeRangeData.startTime;
            if (totalRange <= 0) return;
            
            const startPercent = Math.max(0, Math.min(100, ((timeRangeData.viewStart - timeRangeData.startTime) / totalRange) * 100));
            const endPercent = Math.max(0, Math.min(100, ((timeRangeData.viewEnd - timeRangeData.startTime) / totalRange) * 100));
            
            sliderRange.style.left = startPercent + '%';
            sliderRange.style.width = Math.max(5, endPercent - startPercent) + '%';
            
            // æ›´æ–°æ ‡ç­¾
            const startTime = new Date(timeRangeData.viewStart);
            const endTime = new Date(timeRangeData.viewEnd);
            startLabel.textContent = startTime.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit', hour12: false });
            endLabel.textContent = endTime.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit', hour12: false });
        }
        
        // åˆå§‹åŒ–æ§åˆ¶æ¡
        function initializeSlider() {
            logEvent('å¼€å§‹åˆå§‹åŒ–æ§åˆ¶æ¡');
            
            const slider = document.getElementById('timeRangeSlider');
            const sliderRange = document.getElementById('sliderRange');
            const leftHandle = document.getElementById('leftHandle');
            const rightHandle = document.getElementById('rightHandle');
            
            if (!slider || !sliderRange || !leftHandle || !rightHandle) {
                logEvent('âŒ æ§åˆ¶æ¡å…ƒç´ æœªæ‰¾åˆ°');
                document.getElementById('testStatus').textContent = 'âŒ æ§åˆ¶æ¡å…ƒç´ æœªæ‰¾åˆ°';
                return false;
            }
            
            logEvent('âœ… æ‰€æœ‰æ§åˆ¶æ¡å…ƒç´ æ‰¾åˆ°');
            
            // ç»‘å®šäº‹ä»¶
            bindSliderEvents();
            
            // åˆå§‹åŒ–æ˜¾ç¤º
            timeRangeData.viewStart = timeRangeData.startTime + (timeRangeData.endTime - timeRangeData.startTime) * 0.2;
            timeRangeData.viewEnd = timeRangeData.startTime + (timeRangeData.endTime - timeRangeData.startTime) * 0.8;
            
            updateDisplay();
            
            timeRangeData.initialized = true;
            logEvent('âœ… æ§åˆ¶æ¡åˆå§‹åŒ–å®Œæˆ');
            document.getElementById('testStatus').textContent = 'âœ… æ§åˆ¶æ¡åˆå§‹åŒ–å®Œæˆï¼Œå¯ä»¥æ‹–æ‹½æµ‹è¯•';
            
            return true;
        }
        
        // ç»‘å®šäº‹ä»¶
        function bindSliderEvents() {
            const sliderRange = document.getElementById('sliderRange');
            const leftHandle = document.getElementById('leftHandle');
            const rightHandle = document.getElementById('rightHandle');
            
            // æ‹–æ‹½èŒƒå›´æ¡
            sliderRange.addEventListener('mousedown', (e) => {
                if (e.target === leftHandle || e.target === rightHandle) {
                    return;
                }
                logEvent('å¼€å§‹æ‹–æ‹½èŒƒå›´æ¡');
                timeRangeData.isDragging = true;
                timeRangeData.dragType = 'range';
                timeRangeData.lastMouseX = e.clientX;
                sliderRange.classList.add('dragging');
                e.preventDefault();
            });
            
            // æ‹–æ‹½å·¦æ§åˆ¶ç‚¹
            leftHandle.addEventListener('mousedown', (e) => {
                logEvent('å¼€å§‹æ‹–æ‹½å·¦æ§åˆ¶ç‚¹');
                timeRangeData.isDragging = true;
                timeRangeData.dragType = 'left';
                timeRangeData.lastMouseX = e.clientX;
                leftHandle.classList.add('dragging');
                e.preventDefault();
                e.stopPropagation();
            });
            
            // æ‹–æ‹½å³æ§åˆ¶ç‚¹
            rightHandle.addEventListener('mousedown', (e) => {
                logEvent('å¼€å§‹æ‹–æ‹½å³æ§åˆ¶ç‚¹');
                timeRangeData.isDragging = true;
                timeRangeData.dragType = 'right';
                timeRangeData.lastMouseX = e.clientX;
                rightHandle.classList.add('dragging');
                e.preventDefault();
                e.stopPropagation();
            });
            
            // å…¨å±€é¼ æ ‡ç§»åŠ¨
            document.addEventListener('mousemove', handleMouseMove);
            
            // å…¨å±€é¼ æ ‡é‡Šæ”¾
            document.addEventListener('mouseup', handleMouseUp);
            
            logEvent('âœ… äº‹ä»¶ç»‘å®šå®Œæˆ');
        }
        
        // å¤„ç†é¼ æ ‡ç§»åŠ¨
        function handleMouseMove(e) {
            if (!timeRangeData.isDragging) return;
            
            const sliderTrack = document.querySelector('.slider-track');
            if (!sliderTrack) return;
            
            const rect = sliderTrack.getBoundingClientRect();
            const deltaX = e.clientX - timeRangeData.lastMouseX;
            const totalRange = timeRangeData.endTime - timeRangeData.startTime;
            const deltaTime = (deltaX / rect.width) * totalRange;
            
            logEvent(`é¼ æ ‡ç§»åŠ¨: ${timeRangeData.dragType}, deltaX: ${deltaX}px`);
            
            switch (timeRangeData.dragType) {
                case 'range':
                    // ç§»åŠ¨æ•´ä¸ªçª—å£
                    const currentRange = timeRangeData.viewEnd - timeRangeData.viewStart;
                    let newStart = timeRangeData.viewStart + deltaTime;
                    let newEnd = newStart + currentRange;
                    
                    // è¾¹ç•Œæ£€æŸ¥
                    if (newStart < timeRangeData.startTime) {
                        newStart = timeRangeData.startTime;
                        newEnd = newStart + currentRange;
                    }
                    if (newEnd > timeRangeData.endTime) {
                        newEnd = timeRangeData.endTime;
                        newStart = newEnd - currentRange;
                    }
                    
                    timeRangeData.viewStart = newStart;
                    timeRangeData.viewEnd = newEnd;
                    break;
                    
                case 'left':
                    // è°ƒæ•´å¼€å§‹æ—¶é—´
                    let newViewStart = Math.max(timeRangeData.startTime, 
                        Math.min(timeRangeData.viewEnd - 3600000, timeRangeData.viewStart + deltaTime));
                    timeRangeData.viewStart = newViewStart;
                    break;
                    
                case 'right':
                    // è°ƒæ•´ç»“æŸæ—¶é—´
                    let newViewEnd = Math.min(timeRangeData.endTime,
                        Math.max(timeRangeData.viewStart + 3600000, timeRangeData.viewEnd + deltaTime));
                    timeRangeData.viewEnd = newViewEnd;
                    break;
            }
            
            timeRangeData.lastMouseX = e.clientX;
            updateDisplay();
        }
        
        // å¤„ç†é¼ æ ‡é‡Šæ”¾
        function handleMouseUp() {
            if (!timeRangeData.isDragging) return;
            
            logEvent(`ç»“æŸæ‹–æ‹½: ${timeRangeData.dragType}`);
            
            timeRangeData.isDragging = false;
            timeRangeData.dragType = null;
            
            // ç§»é™¤æ‹–æ‹½æ ·å¼
            document.querySelectorAll('.dragging').forEach(el => {
                el.classList.remove('dragging');
            });
        }
        
        // æµ‹è¯•å‡½æ•°
        function testControlEvents() {
            logEvent('=== å¼€å§‹æµ‹è¯•æ§åˆ¶äº‹ä»¶ ===');
            
            const elements = {
                slider: document.getElementById('timeRangeSlider'),
                range: document.getElementById('sliderRange'),
                leftHandle: document.getElementById('leftHandle'),
                rightHandle: document.getElementById('rightHandle')
            };
            
            for (const [name, el] of Object.entries(elements)) {
                if (el) {
                    logEvent(`âœ… ${name}: å­˜åœ¨`);
                    // æµ‹è¯•ç‚¹å‡»äº‹ä»¶
                    el.addEventListener('click', () => {
                        logEvent(`ğŸ–±ï¸ ${name} è¢«ç‚¹å‡»`);
                    });
                } else {
                    logEvent(`âŒ ${name}: ä¸å­˜åœ¨`);
                }
            }
            
            logEvent('=== æµ‹è¯•å®Œæˆ ===');
        }
        
        function resetSlider() {
            logEvent('é‡ç½®æ»‘å—');
            timeRangeData.viewStart = timeRangeData.startTime;
            timeRangeData.viewEnd = timeRangeData.endTime;
            updateDisplay();
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            logEvent('é¡µé¢åŠ è½½å®Œæˆ');
            setTimeout(() => {
                initializeSlider();
            }, 100);
        });
    </script>
</body>
</html>
